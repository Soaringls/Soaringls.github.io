<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="https://example.com/M%26L/point_matcher/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>note of pointmatcher - MkLorum</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "note of pointmatcher";
    var mkdocs_page_input_path = "M&L/point_matcher.md";
    var mkdocs_page_url = "/M%26L/point_matcher/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> MkLorum</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="" href="../../about.md">About</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">MkLorum</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>note of pointmatcher</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="note-of-pointmatcher">note of pointmatcher</h1>
<h2 id="icp">简要ICP</h2>
<ul>
<li>target(ref-scan|pre-scan)和source(read-scan|cur-scan)去除质心
  $$
   R^<em> = argmin \frac{1}{2} \sum_{i=1}^{n} \lVert q_t -  R q_s\rVert^2 \\
   t^</em> = q_t - R q_s \\
   W = \sum \left( q_t q_s^T\right) = U  \Sigma V^T \to R = UV^T \qquad t = q_t - Rq_s
  $$</li>
<li>residuals可由<code>point-&gt;point</code>、<code>point-&gt;line</code>、<code>point-&gt;plane</code></li>
</ul>
<h2 id="pointmatcher">PointMatcher</h2>
<h3 id="ref-reading">ref 和 reading 去除质心</h3>
<ul>
<li><code>tf_refi_in_refmean</code></li>
<li>reference原点为ref</li>
<li>算法流程</li>
<li>T-&gt;init Identity Transform</li>
<li>对reading做$T$变换,形成reading_reset</li>
<li>对reading_reset中每个点在reference中寻找最邻近的点,并保存距离和index</li>
</ul>
<h3 id="details">details</h3>
<ul>
<li>ref's Normal<blockquote>
<p>e.g $3 \times 277$</p>
</blockquote>
</li>
</ul>
<p>$$
   \begin{bmatrix}
       x_1 &amp;x_2 &amp;... &amp;x_n \\
       y_1 &amp;y_2 &amp;... &amp;y_n \\
       z_1 &amp;z_2 &amp;... &amp;z_n<br />
   \end{bmatrix}
  $$</p>
<ul>
<li>$reading \times ref's normal$, which is $277 \times 3 \cdot 3 \times 277$</li>
</ul>
<p>$$
    tmp = \begin{bmatrix}
        0 &amp;-1 &amp; 0 \\
        1 &amp;0 &amp; 0 \\
        0 &amp; 0 &amp;0
    \end{bmatrix} \times
    \begin{bmatrix}
        x_1 &amp;x_2 &amp;x_3  &amp;... \\
        y_1 &amp;y_2 &amp;y_3  &amp;... \\
        z_1 &amp;z_2 &amp;z_3  &amp;...<br />
    \end{bmatrix} \to 
    \begin{bmatrix}
        -y_1 &amp; -y_2 &amp; -y_3 &amp; ... \\
        x_1 &amp;  x_2 &amp;  x_3 &amp; ... \\
        0 &amp;  0 &amp; 0 &amp; ... 
    \end{bmatrix}\\
  $$</p>
<p>$$
  ret = tmp^T \times ref's normal \quad is \quad N \times N, which 
    = \begin{bmatrix}
        -y1 &amp; x1 &amp; 0 \\
        -y2 &amp; x2 &amp; 0 \\
        -y3 &amp; x3 &amp; 0 \\
        ... &amp; ... &amp;... 
       \end{bmatrix} \times
       \begin{bmatrix}
          nx_1 &amp; nx_2 &amp; ... \\
          ny_1 &amp; ny_2 &amp; ... \\
          nz_1 &amp; nz_2 &amp; ... 
       \end{bmatrix} =
       \begin{bmatrix}
        -y_1nx_1 + x_1ny_1 &amp; elem_{12} &amp; .....\\
        elem_{21} &amp; -y_2nx_2 + x_2ny_2 &amp; .....\\
        .... &amp; ...&amp;-y_nnx_n + x_nny_n
       \end{bmatrix}
  $$</p>
<p>取$ret$的对角线,即为reading点云到ref's normal的距离(点到法向量的距离)
  $tmp2 = ret.diagonal.transpose = \begin{bmatrix}
      d1 &amp; d2 &amp; d3 &amp; ...&amp; d_n
  \end{bmatrix}$</p>
<ul>
<li>$A=WF \cdot F^t \to AX=b \qquad (4, 4) \times (4, 1) \to (4, 1)$
  $$
    A \cdot x=\begin{bmatrix}
       \sum_{i=1}^n d_i\cdot wd_i &amp; &amp; &amp;  \\
       &amp; \sum_{i=1}^nwnx_i\cdot nx_i &amp; &amp; \\
       &amp; &amp; \sum_{i=1}^nwny_i\cdot ny_i &amp; \\
       &amp; &amp; &amp; \sum_{i=1}^nwnz_i\cdot nz_i 
    \end{bmatrix} 
    \begin{bmatrix}
        yaw \\ X \\ Y \\ Z
    \end{bmatrix} = b
  $$</li>
</ul>
<p>$$
    b = \underbrace{
        \begin{bmatrix}
            &amp; tmp2 \cdot \omega(权重) \\
            nx_1 &amp; nx_2 &amp; ...\\
            ny_1 &amp; ny_2 &amp; ...\\
            nz_1 &amp; nz_2 &amp; ...
        \end{bmatrix}
    }<em>{WF} \times
    \underbrace{
        \begin{bmatrix}
            \Delta x_1 nx_1 + \Delta y_1 ny_1 + \Delta z_1 nz_1 \\
            \Delta x_2 nx_2 + \Delta y_2 ny_2 + \Delta z_2 nz_2 \\
            ...\\
        \end{bmatrix}
    } =  -\underbrace{
         \begin{bmatrix}
             \sum</em>{i=1}^n d_i \cdot (\Delta x_i nx_i + \Delta y_i ny_i + \Delta z_i      nz_i) \\
             \sum_{i=1}^n nx_i \cdot (\Delta x_i nx_i + \Delta y_i ny_i + \Delta z_i      nz_i) \\
             \sum_{i=1}^n ny_i \cdot (\Delta x_i nx_i + \Delta y_i ny_i + \Delta z_i      nz_i) \\
             \sum_{i=1}^n nz_i \cdot (\Delta x_i nx_i + \Delta y_i ny_i + \Delta z_i      nz_i) 
         \end{bmatrix}
    }_{(4\times1)}
    $$</p>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
